<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>JSN | Chat</title>
    <link rel="stylesheet" href="~/assets/css/style.min.css" />
    <link rel="stylesheet" href="~/assets/css/mobile.min.css" />
    <link rel='shortcut icon' type='image/x-icon' href='~/assets/images/JSN_Favicon.png' />
    <style>
        /* The Modal (background) */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

        /* Modal Content/Box */
        .modal-content {
            background-color: #fefefe;
            margin: 15% auto; /* 15% from the top and centered */
            padding: 20px;
            border: 1px solid #888;
            width: 80%; /* Could be more or less, depending on screen size */
        }

        /* The Close Button */
        .close {
            color: red;
            float: right;
            font-size: 32px;
            font-weight: bold;
        }

            .close:hover,
            .close:focus {
                color: black;
                text-decoration: none;
                cursor: pointer;
            }

        .container1 {
            position: fixed;            
        }

        .center1 {
            border: 3px solid green;
            margin: 0;
            position: absolute;
            top: 50%;
            left: 50%;
            -ms-transform: translate(-50%, -50%);
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body style="overflow-y: scroll;">
    <br />
    <header class="dashboard-header">
        <div class="container">
            <div class="logo-wrapper">
                <a href="#">
                    <img class="logo" src="~/assets/images/JSN_Logo.png" style="width:200px" alt="logo" />
                </a>
            </div>
            <nav>
                <span class="profile-menu">
                    <img src="~/assets/images/Profile.png" alt="profile-img" />
                    <img src="~/assets/images/Profile Arrow.png" alt="profile-img" />
                </span>
            </nav>
        </div>
    </header>

    <div class="top">
        <div class="container">
            <h1>Covid Conversation Scenario - @ViewBag.Mode</h1>
            <a href="/Home/login">
                <img src="~/assets/images/cancel.png" alt="cancel btn" />
            </a>
        </div>
    </div>

    <div class="chat-wrapper">
        <div class="container">
            <div class="chat-bot-wrapper">
                <div class="chat">
                    <div class="body" id="Text">

                        @*<p class="bot">
                                Lorem ipsum dolor sit amet consectetur adipisicing elit. Facere,
                                illum? Non delectus dolor placeat veniam unde consequatur
                                corporis incidunt! Dolor quae harum asperiores tenetur autem,
                                necessitatibus nostrum beatae adipisci dolores magni fugit
                                deserunt corporis ex!
                            </p>
                            <p class="user">
                                Lorem ipsum dolor sit amet consectetur adipisicing elit. Rerum
                                at tenetur illo tempore, perferendis sapiente impedit?
                            </p>*@
                    </div>

                    <div class="bottom">
                        <input class="msg-input"
                               type="text"
                               placeholder="Thanks for calling.." />

                        <button id="recButton"><img id="mic_img" src="~/assets/images/RedMic.png" alt="mic img" /></button>

                        <button id="HoldButton">
                            <span class="time" id="HoldSeconds">00:00</span>
                            <img id="dair_img" src="~/assets/images/RedClock.png" alt="mic img" />
                        </button>
                    </div>
                </div>
                <div class="bot">
                    <div class="body">
                        <img src="~/assets/images/Bot.png" alt="bot img" />
                    </div>
                    <div class="bottom">
                        <button class="btn primary-btn" id="submit_btn">Submit</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <br>
    <br>
    <!-- The Modal -->
    <div id="myModal" class="modal container1" style="min-height:150px; text-align: center;">
        <!-- Modal content -->
        <div class="modal-content center1" style="width:350px;">
            <span class="close">&times;</span>
            <br />
            <p style="font-size: 28px;
            font-weight: bold; color:black;">Thank you for using this service..</p>
        </div>
    </div>

    <footer style="position: fixed;">
        <div class="container">
            <p>
                &copy; 2021, JumpStartNinja. All <a href="#">rights</a> reserved.
            </p>
        </div>
    </footer>

    <script src="~/assets/css/jquery/jquery-3.2.1.min.js"></script>
    <script>


        var DeadAirButton = document.getElementById("HoldButton");
        var DeadAirTimer = 0;
        var DeadAirTime = -1;
        //DeadAirButton.addEventListener("click", countupStart)
        function countupStart() {
            if (DeadAirTime !== -1) {
                console.log("Started");
                $("#dair_img").attr("src", "/assets/images/GreenClock.png");
                //DeadAirButton.className = "hold Rec";
                //$("#DeadAirButton").removeClass("release").addClass("hold");
                countup();
                //DeadAirButton.removeEventListener("click", countupStart);
                DeadAirButton.addEventListener("click", countupStop);
                //DeadAirButton.value = "Release";
            }
            else {
                alert('Please confirm with Customer');
            }

        }

        function countupStop() {
            console.log("Stopped");
            //$("#DeadAirButton").removeClass("hold").addClass("release");
            //DeadAirButton.className = "release";
            clearInterval(DeadAirTimer);
            //$('#LblMinutes').html('Dead Air Timer');
            document.getElementById("HoldSeconds").innerHTML = '00:00';
            DeadAirButton.removeEventListener("click", countupStop);
            //DeadAirButton.addEventListener("click", countupStart);
            //DeadAirButton.value = "Hold";
            $("#dair_img").attr("src", "/assets/images/RedClock.png");
            function pad(val) { return val > 9 ? val : "0" + val; }
            if (DeadAirTime < sec) {
                DeadAirFlag = false;
                //alert('you have taken ' + pad(parseInt((sec - DeadAirTime) / 60, 10)) + ':' + pad((sec - DeadAirTime) % 60) + ' excessive');
            }
            else {
                //alert('you have taken only ' + pad(parseInt((sec) / 60, 10)) + ':' + pad((sec) % 60));
            }
            DeadAirTime = -1;
            displayRecord();
        }
        var sec = 0;
        function countup() {
            sec = 0;
            function pad(val) { return val > 9 ? val : "0" + val; }
            DeadAirTimer = setInterval(function () {
                document.getElementById("HoldSeconds").innerHTML = pad(parseInt(sec / 60, 10)) + ':' + pad(++sec % 60);
                //$('#LblMinutes').html('Dead Air Timer ' + pad(parseInt(sec / 60, 10)) + ':' + pad(++sec % 60));
                //document.getElementById("seconds").innerHTML = pad(++sec % 60);
                //document.getElementById("minutes").innerHTML = pad(parseInt(sec / 60, 10));
            }, 1000);
        }

        var Officer = [];
        var DeadAirFlag = true;
        $('#submit_btn').hide();
        //$('#submit_btn').attr("disabled", true);

        function a() {
            document.location = "/Home/Finalscore_UnblockDebitcard";
        }
        var buttoncount = 1;
        var langu = "";
        var recognition = null;
        var recButton = document.getElementById("recButton");
        //$('#buttonRecordSpeak').hide();
        //$('#buttonRecordListen').hide();

        var currentQuestion = "";
        var MainText = "";
        var SpeakFlag = true;

        //document.addEventListener('recButton', function () {
        //    el.addEventListener('click', InitializeRecording, false);
        //});

        recButton.addEventListener("click", InitializeRecording);

        init("en-IN");

        function init(language1) {
            //var lang = language1;
            console.log("inside init "+language1);

            window.SpeechRecognition = window.webkitSpeechRecognition || window.SpeechRecognition;
            //let finalTranscript = '';
            recognition = new window.SpeechRecognition();
            recognition.interimResults = true;
            recognition.lang = language1;

            recognition.maxAlternatives = 1;
            recognition.continuous = true;
            recognition.onresult = (event) => {

                if (SpeakFlag) {
                    let interimTranscript = '';

                    for (let i = event.resultIndex, len = event.results.length; i < len; i++) {

                        let transcript = event.results[i][0].transcript;

                        if (event.results[i].isFinal) {
                            $("#Text").html(MainText + "<p class='user'>" + transcript + "</p>");
                            currentQuestion = transcript;
                            $('#Text').scrollTop($('#Text')[0].scrollHeight);
                            MainText = $('#Text').html();
                            GetData(language1);
                        }
                        else {
                            interimTranscript += transcript;
                        }
                    }
                    if (SpeakFlag) {
                        $("#Text").html(MainText + "<p class='user'>" + interimTranscript + "</p>");
                        $('#Text').scrollTop($('#Text')[0].scrollHeight);
                    }
                }
            }
            recognition.onaudiostart = function () {
                beep();
                //$('#buttonRecordSpeak').show();
                //$('#buttonRecordListen').hide();
            }

            recognition.onspeechend = function () {
                console.log('Stopped')
                //cognition.stop();
            }
            recognition.onnomatch = function (event) {
                console.log('I didnt recognise that color.');
            }

            recognition.onerror = function (event) {
                recognition.stop();
                $("#mic_img").attr("src", "/assets/images/RedMic.png");
                console.log('Error occurred in recognition: ' + event.error);
            }

             function displayRecord() {
            MainText = $('#Text').html();
            RecordingStart();
            SpeakFlag = true;
        }

        function beep() {
            var snd = new Audio("data:audio/wav;base64,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qJrx4KOQjahZxWbcZgztj2c49nKmkId44S71j0c8eV9yDK6uPRzx5X18eDvjvQ6yKo9ZSS6l//8elePK/Lf//IInrOF/FvDoADYAGBMGb7FtErm5MXMlmPAJQVgWta7Zx2go+8xJ0UiCb8LHHdftWyLJE0QIAIsI+UbXu67dZMjmgDGCGl1H+vpF4NSDckSIkk7Vd+sxEhBQMRU8j/12UIRhzSaUdQ+rQU5kGeFxm+hb1oh6pWWmv3uvmReDl0UnvtapVaIzo1jZbf/pD6ElLqSX+rUmOQNpJFa/r+sa4e/pBlAABoAAAAA3CUgShLdGIxsY7AUABPRrgCABdDuQ5GC7DqPQCgbbJUAoRSUj+NIEig0YfyWUho1VBBBA//uQZB4ABZx5zfMakeAAAAmwAAAAF5F3P0w9GtAAACfAAAAAwLhMDmAYWMgVEG1U0FIGCBgXBXAtfMH10000EEEEEECUBYln03TTTdNBDZopopYvrTTdNa325mImNg3TTPV9q3pmY0xoO6bv3r00y+IDGid/9aaaZTGMuj9mpu9Mpio1dXrr5HERTZSmqU36A3CumzN/9Robv/Xx4v9ijkSRSNLQhAWumap82WRSBUqXStV/YcS+XVLnSS+WLDroqArFkMEsAS+eWmrUzrO0oEmE40RlMZ5+ODIkAyKAGUwZ3mVKmcamcJnMW26MRPgUw6j+LkhyHGVGYjSUUKNpuJUQoOIAyDvEyG8S5yfK6dhZc0Tx1KI/gviKL6qvvFs1+bWtaz58uUNnryq6kt5RzOCkPWlVqVX2a/EEBUdU1KrXLf40GoiiFXK///qpoiDXrOgqDR38JB0bw7SoL+ZB9o1RCkQjQ2CBYZKd/+VJxZRRZlqSkKiws0WFxUyCwsKiMy7hUVFhIaCrNQsKkTIsLivwKKigsj8XYlwt/WKi2N4d//uQRCSAAjURNIHpMZBGYiaQPSYyAAABLAAAAAAAACWAAAAApUF/Mg+0aohSIRobBAsMlO//Kk4soosy1JSFRYWaLC4qZBYWFRGZdwqKiwkNBVmoWFSJkWFxX4FFRQWR+LsS4W/rFRb/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////VEFHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAU291bmRib3kuZGUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMjAwNGh0dHA6Ly93d3cuc291bmRib3kuZGUAAAAAAAAAACU=");
            snd.play();
        }

        function GetData(language) {
            recognition.stop();
            SpeakFlag = false;
            //$('#buttonRecordSpeak').hide();
            //$('#buttonRecordListen').show();
            console.log("Voice Started:");
            console.log(currentQuestion);
            console.log("inside " + language);
            var obj = {};
            obj.Text = currentQuestion;
            obj.Language = language;
            obj.Count = buttoncount;
            $.ajax({
                type: "POST",
                data: obj,
                url: "/Home/GetText/",
                success: function (response) {
                    try {
                        console.log(response);
                        if (response.StatusCode == 200) {
                            var Text = response.Text;
                            $("#Text").html(MainText + "<p class='bot'>" + Text + "</p>");
                            $('#Text').scrollTop($('#Text')[0].scrollHeight);
                            //Officer.push(response.TranslatedText);
                            var Voice = response.Voice;
                            var snd = new Audio(Voice);
                            snd.play();

                            if (buttoncount > 0 && buttoncount <8) {
                                langu = "en-IN";
                                var snd = new Audio(Voice);
                                snd.play();
                                snd.addEventListener("ended", displayRecord);
                                buttoncount += 1;
                                init(langu);
                            }                            
                            else {
                                $('#submit_btn').show();

                                $('#submit_btn').click(function () {

                                    // Get the modal
                                    var modal = document.getElementById("myModal");
                                    modal.style.display = "block";
                                    // Get the <span> element that closes the modal
                                    var span = document.getElementsByClassName("close")[0];

                                    setInterval(function () {
                                        document.location = "/Home/login";
                                    }, 2000);
                                    // When the user clicks on <span> (x), close the modal
                                    span.onclick = function () {
                                        document.location = "/Home/login";
                                        //modal.style.display = "none";

                                    }

                                    // When the user clicks anywhere outside of the modal, close it
                                    window.onclick = function (event) {
                                        if (event.target == modal) {
                                            //modal.style.display = "none";
                                            document.location = "/Home/login";
                                        }

                                    }
                                    //document.location = "/Home/Finalscore_UnblockDebitcard?Mode=@ViewBag.Mode";
                                });

                                snd.addEventListener("ended", function () {

                                    //$('#buttonRecordSpeak').hide();
                                    //$('#buttonRecordListen').hide();
                                    //$('#buttonRecord').show();
                                    //$('#recButton').attr("disabled", false);
                                    //$('#recButton').removeClass("NotClickable");
                                });
                                $("#mic_img").attr("src", "/assets/images/RedMic.png");
                                langu = "en-IN";
                                buttoncount = 0;
                            }

                        }

                        else if (response.StatusCode == 300) {
                            var Text = response.Text;
                            $("#Text").html(MainText + "<p class='bot'>" + Text + "</p>");
                            $('#Text').scrollTop($('#Text')[0].scrollHeight);
                            var Voice = response.Voice;
                            var snd = new Audio(Voice);
                            snd.play();
                            MainText = $('#Text').html();
                            snd.addEventListener("ended", function () {
                                $("#mic_img").attr("src", "/assets/images/RedMic.png");
                                //$('#buttonRecordSpeak').hide();
                                //$('#buttonRecordListen').hide();
                                //$('#buttonRecord').show();
                                //$('#recButton').attr("disabled", false);
                                //$('#recButton').removeClass("NotClickable");
                            });
                            $('#submit_btn').show();
                            $('#submit_btn').click(function () {
                                    // Get the modal
                                var modal = document.getElementById("myModal");
                                modal.style.display = "block";
                                    // Get the <span> element that closes the modal
                                    var span = document.getElementsByClassName("close")[0];
                                setInterval(function () {
                                    document.location = "/Home/login";
                                }, 2000);
                                    // When the user clicks on <span> (x), close the modal
                                    span.onclick = function () {
                                        document.location = "/Home/login";
                                        //modal.style.display = "none";

                                    }

                                    // When the user clicks anywhere outside of the modal, close it
                                    window.onclick = function (event) {
                                        if (event.target == modal) {
                                            //modal.style.display = "none";
                                            document.location = "/Home/login";
                                        }
                                    }
                                    //document.location = "/Home/Finalscore_UnblockDebitcard?Mode=@ViewBag.Mode";
                                });
                        }
                        else {
                            MainText = $('#Text').html();
                            $('#submit_btn').show();
                           $('#submit_btn').click(function () {

                                    // Get the modal
                               var modal = document.getElementById("myModal");
                               modal.style.display = "block";
                                    // Get the <span> element that closes the modal
                                    var span = document.getElementsByClassName("close")[0];
                               setInterval(function () {
                                   document.location = "/Home/login";
                               }, 2000);
                                    // When the user clicks on <span> (x), close the modal
                                    span.onclick = function () {
                                        document.location = "/Home/login";
                                        //modal.style.display = "none";

                                    }

                                    // When the user clicks anywhere outside of the modal, close it
                                    window.onclick = function (event) {
                                        if (event.target == modal) {
                                            //modal.style.display = "none";
                                            document.location = "/Home/login";
                                        }
                                    }
                                    //document.location = "/Home/Finalscore_UnblockDebitcard?Mode=@ViewBag.Mode";
                                });
                            //$('#buttonRecordSpeak').hide();
                            //$('#buttonRecordListen').hide();
                            //$('#buttonRecord').show();
                            //$('#recButton').attr("disabled", false);
                            //$('#recButton').removeClass("NotClickable");
                        }
                    }
                    catch (err) {
                        console.log(err);
                    }
                },
                error: function (response) {
                    console.log('exc');
                }
            });
        }

        function RecordingStart() {
            recognition.start();
            console.log("Speech Started");
        }
        }

        function InitializeRecording() {
            //$('#buttonRecord').hide();
            //$('#recButton').addClass("NotClickable");
            //$('#recButton').attr("disabled", true);

            //$('#buttonRecordSpeak').show();
            //$('#buttonRecordListen').hide();

            console.log(buttoncount);
            if ($('#mic_img').attr('src') == "/assets/images/RedMic.png") {
                $("#mic_img").attr("src", "/assets/images/GreenMic.png");
                MainText = "";
                Officer = [];
                $('#submit_btn').hide();
                DeadAirFlag = true;
                SpeakFlag = true;
                recognition.start();
                $('#Text').html("");
            }
        }

    </script>

</body>

</html>
